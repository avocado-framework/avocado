from autotest.client.shared import distro

DEFAULT_MACHINE_TYPE = "i440fx"
DEFAULT_GUEST_OS = "JeOS.19"


def get_default_guest_os_info():
    """
    Gets the default asset and variant information depending on host OS
    """
    os_info = {'asset': 'jeos-19-64', 'variant': DEFAULT_GUEST_OS}

    detected = distro.detect()
    if detected.name == 'fedora' and int(detected.version) >= 20:
        os_info = {'asset': 'jeos-20-64', 'variant': 'JeOS.20'}

    return os_info


def params():
    return {'indirect_image_blacklist': '/dev/hda[\\d]* /dev/sda[\\d]* /dev/sg0 /dev/md0', 'screendump_quality': '30', 'boot_menu': 'off', 'test_timeout': '14400', 'image_size': '10G', 'take_regular_screendumps': 'yes', 'image_remove_command': 'rm -rf %s', 'keep_screendumps_on_error': 'yes', 'login_timeout': '360', 'isa_serials': 'serial0', 'vm_arch_name': 'x86_64', 'shell_port': '22', 'guest_port_remote_shell': '22', 'vms': 'virt-tests-vm1', 'usb_devices': 'tablet1', '_name_map_file': {'tests.cfg': 'qemu_kvm_jeos_quick', 'machines.cfg': 'i440fx', 'subtests.cfg': '(subtest=type_specific).(subtest=io-github-autotest-qemu).(subtest=migrate).default.tcp', 'guest-hw.cfg': '(image_backend=filesystem).no_9p_export.smallpages.no_pci_assignable.qcow2.virtio_blk.smp2.virtio_net', 'guest-os.cfg': 'Linux.JeOS.20.x86_64'}, 'backup_image_on_check_error': 'no', 'vnc_autoport': 'yes', 'kill_vm_on_error': 'yes', 'virt_install_wait_time': '300', 'local_pwd': '', 'use_virt_install_wait': 'no', 'cdrom_check_cdrom_pattern': '/dev/cdrom-\\w+|/dev/cdrom\\d*', 'screendump_delay': '5', 'drive_index_cd1': '1', 'boot_order': 'cdn', 'screendump_temp_dir': '/dev/shm', 'migrate_source_host': 'ENTER.YOUR.SOURCE.EXAMPLE.COM', 'vcpu_thread_pattern': 'thread_id.?[:|=]\\s*(\\d+)', 'vfd_size': '1440k', 'usb_max_port': '2', 'machine_type': 'pc', 'start_vm': 'yes', 'password': '123456', 'usb_type': 'ich9-usb-uhci1', 'migrate_vms': '', 'mem_chk_cmd': "dmidecode -t 17 | awk -F: '/Size/ {print $2}'", 'vm_register_delay': '5', 'name': 'qemu_kvm_jeos_quick.(image_backend=filesystem).no_9p_export.smallpages.no_pci_assignable.qcow2.virtio_blk.smp2.virtio_net.Linux.JeOS.20.x86_64.i440fx.(subtest=type_specific).(subtest=io-github-autotest-qemu).(subtest=migrate).default.tcp', 'usb_controller_tablet1': 'uhci', 'subtest': 'io-github-autotest-qemu.migrate', 'use_autostart': 'no', 'nic_model': 'virtio', 'os_type': 'linux', 'drive_rerror_image1': '', 'use_os_type': 'yes', 'usbs': 'usb1', 'migration_bg_kill_command': 'pkill -9 tcpdump', 'kvm_default': {'/sys/module/kvm/parameters/ignore_msrs': 'N', '/sys/module/kvm/parameters/min_timer_period_us': '500', '/sys/module/kvm/parameters/allow_unsafe_assigned_interrupts': 'N', '/sys/module/kvm/parameters/tsc_tolerance_ppm': '250', '/sys/module/kvm/parameters/mmu_audit': 'N'}, 'images': 'image1', 'used_cpus': '2', 'url_auto_ip': '192.168.122.1', 'drive_werror_image1': '', 'usb_type_tablet1': 'usb-tablet', 'host_setup_flag': 1, 'image_unbootable_pattern': 'Hard Disk.*not a bootable disk', 'migrate_load_vms': '', 'smp': '2', 'qemu_io_binary': '/bin/qemu-io', 'restore_image_on_check_error': 'no', 'keep_video_files_on_error': 'yes', 'image_clone_command': 'cp --reflink=auto %s %s', 'nettype': 'user', 'mem': '1024', 'image_name': 'images/jeos-20-64', 'used_mem': '1024', 'encode_video_files': 'yes', 'restore_image': 'yes', 'pci_assignable': 'no', 'image_boot': 'yes', 'paused_after_start_vm': 'no', 'auto_cpu_model': 'yes', 'boot_once': 'c', 'keep_screendumps': 'yes', 'migration_protocol': 'tcp', 'connect_uri': 'default', 'provider': 'io-github-autotest-qemu', 'monitor_type': 'human', 'netdst': 'virbr0', 'kill_unresponsive_vms': 'yes', '_short_name_map_file': {'tests.cfg': 'qemu_kvm_jeos_quick', 'machines.cfg': 'i440fx', 'subtests.cfg': 'type_specific.io-github-autotest-qemu.migrate.default.tcp', 'guest-hw.cfg': 'filesystem.no_9p_export.smallpages.no_pci_assignable.qcow2.virtio_blk.smp2.virtio_net', 'guest-os.cfg': 'Linux.JeOS.20.x86_64'}, 'cpu_chk_cmd': 'ls /sys/devices/system/cpu | egrep -c "cpu[0-9]+$"', 'drive_format': 'virtio', 'migration_test_command': 'help', 'use_debug': 'yes', 'kill_vm_gracefully': 'yes', 'cdrom_test_cmd': 'dd if=%s of=/dev/null bs=1 count=1', 'iterations': '2', 'drive_index_image1': '0', 'image_format': 'qcow2', 'virt_test_type': 'qemu', 'cdroms': 'cd1', 'backup_dir': 'images/', 'usb_type_usb1': 'ich9-usb-uhci1', 'file_transfer_port': '22', 'skip_image_processing': 'no', 'type': 'migration', 'kill_vm_before_test': 'no', 'migrate_dest_pwd': 'PASSWORD.DEST.EXAMPLE', 'other_tests_dirs': '', 'username': 'root', 'image_backend': 'filesystem', 'profilers': 'kvm_stat', 'run_tcpdump': 'no', 'reboot_command': 'shutdown -r now', 'image_chain': '', 'cdrom_get_cdrom_cmd': 'ls /dev/cdrom*', 'shutdown_command': 'shutdown -h now', 'migrate_port': '49152', 'kill_vm': 'yes', 'shortname': 'qcow2.virtio_blk.smp2.virtio_net.JeOS.20.x86_64.io-github-autotest-qemu.migrate.tcp', 'screendump_verbose': 'no', 'mig_timeout': '3600', 'install_virtio': 'no', 'dep': ['qemu_kvm_jeos_quick.(image_backend=filesystem).no_9p_export.smallpages.no_pci_assignable.qcow2.virtio_blk.smp2.virtio_net.Linux.JeOS.20.x86_64.i440fx.(subtest=type_specific).install', 'qemu_kvm_jeos_quick.(image_backend=filesystem).no_9p_export.smallpages.no_pci_assignable.qcow2.virtio_blk.smp2.virtio_net.Linux.JeOS.20.x86_64.i440fx.(subtest=type_specific).setup', 'qemu_kvm_jeos_quick.(image_backend=filesystem).no_9p_export.smallpages.no_pci_assignable.qcow2.virtio_blk.smp2.virtio_net.Linux.JeOS.20.x86_64.i440fx.(subtest=type_specific).image_copy', 'qemu_kvm_jeos_quick.(image_backend=filesystem).no_9p_export.smallpages.no_pci_assignable.qcow2.virtio_blk.smp2.virtio_net.Linux.JeOS.20.x86_64.i440fx.(subtest=type_specific).unattended_install.cdrom'], 'status_test_command': 'echo $?', 'mem_chk_re_str': '[^\\$]([0-9]+)', 'netdev_peer_re': '\\s{2,}(.*?): .*?\\\\\\s(.*?):', 'cpu_model_flags': '', 'store_vm_register': 'yes', 'inactivity_watcher': 'log', 'display': 'vnc', 'keep_video_files': 'yes', 'migration_bg_check_command': 'pgrep tcpdump', 'ping_pong': '1', 'keep_ppm_files': 'no', 'image_verify_bootable': 'yes', 'mem_chk_cur_cmd': 'grep MemTotal /proc/meminfo', 'migrate_proto': 'tcp', 'use_os_variant': 'no', 'redirs': 'remote_shell', 'migrate_dest_host': 'ENTER.YOUR.DEST.EXAMPLE.COM', 'qemu_img_binary': '/bin/qemu-img', 'check_image': 'yes', 'image_raw_device': 'no', 'remote_pwd': '', 'keep_ppm_files_on_error': 'no', 'use_check_cpu': 'yes', 'remote_user': 'root', 'vm_type': 'qemu', 'skip_cluster_leak_warn': 'no', 'nics': 'nic1', 'vga': 'std', 'qemu_binary': '/bin/qemu-kvm', 'backup_image': 'no', 'remote_ip': 'ENTER.YOUR.REMOTE.EXAMPLE.COM', 'monitors': 'hmp1', 'shell_prompt': '^\\[.*\\][\\#\\$]\\s*$', 'shell_client': 'ssh', 'migrate_shared_storage': 'SHARED_IMAGE.EXAMPLE.COM', 'os_variant': 'fedora20', 'kill_timeout': '60', 'malloc_perturb': 'yes', 'use_no_reboot': 'no', 'file_transfer_client': 'scp', 'main_vm': 'virt-tests-vm1', 'migration_bg_command': 'cd /tmp; nohup tcpdump -q -i any -t ip host localhost', 'skip_image_check_during_running': 'no', 'local_ip': 'ENTER.YOUR.LOCAL.EXAMPLE.COM', 'strict_mode': 'no', 'convert_ppm_files_to_png': 'no', 'enable_msix_vectors': 'yes', 'inactivity_treshold': '1800', 'migrate_source_pwd': 'PASSWORD.SOURCE.EXAMPLE'}
