name: GH Actions

on:
  pull_request:
  workflow_dispatch:

jobs:


# Checks that Python packages builds succeeds

  package-build:
    name: Build Package (wheel/tarball) for Python ${{ matrix.python-version }}
    runs-on: ubuntu-20.04

    strategy:
      matrix:
        python-version: [3.6, 3.7, 3.8, 3.9, 3.10.0]
      fail-fast: false

    steps:
    - uses: actions/checkout@v2
    - name: Set up Python
      uses: actions/setup-python@v2
      with:
        python-version: ${{ matrix.python-version }}
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install build
    - name: Build package
      run: python -m build

  egg-build:
    name: Build Egg for Python ${{ matrix.python-version }} from ${{ matrix.plugin }}
    runs-on: ubuntu-20.04

    strategy:
      matrix:
        python-version: [3.6, 3.7, 3.8, 3.9, 3.10.0]
        plugin: [".", "optional_plugins/golang", "optional_plugins/html", "optional_plugins/resultsdb", "optional_plugins/result_upload", "optional_plugins/robot", "optional_plugins/varianter_cit", "optional_plugins/varianter_pict", "optional_plugins/varianter_yaml_to_mux"]
      fail-fast: false

    - name: Build eggs
      run: |
        cd ${{ matrix.plugin }}
        python setup.py bdist_egg
    - name: Save eggs as artifacts
      uses: actions/upload-artifact@v2
      with:
        name: egg-${{ matrix.plugin }}-${{ matrix.python-version }}
        path: /home/runner/work/avocado/avocado/${{ matrix.plugin }}/dist/
        retention-days: 1
    - run: echo "ðŸ¥‘ This job's status is ${{ job.status }}."

