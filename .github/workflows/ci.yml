name: GH Actions

on:
  pull_request:
  workflow_dispatch:

jobs:
  static-checks:

    name: Static checks
    runs-on: ubuntu-20.04
    container:
      image: quay.io/avocado-framework/avocado-ci-fedora-36

    steps:
      - run: echo "Job triggered by a ${{ github.event_name }} event on branch is ${{ github.ref }} in repository is ${{ github.repository }}, runner on ${{ runner.os }}"
      - name: Check out repository code
        uses: actions/checkout@v3
        with:
          fetch-depth: 0
      - name: Allow git to operate on directory checked out by GH Actions
        run: git config --global --add safe.directory `pwd`
      - name: Installing Avocado development dependencies
        run: make requirements-dev
      - name: Installing Avocado in develop mode
        run: python3 setup.py develop --user
      - name: Run static checks
        run: python3 setup.py test --select=static-checks
      - name: Archive failed tests logs
        if: failure()
        uses: actions/upload-artifact@v3
        with:
          name: static-checks-logs
          path: /home/runner/avocado/job-results/
          retention-days: 1
      - run: echo "ðŸ¥‘ This job's status is ${{ job.status }}."
